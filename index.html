<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no viewport-fit=cover"">
    <title>Days in Maghribal - Polish Ver</title>
    <link rel="icon" href="data:,">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/style.css">
    <script src="js/game_data.js"></script>
    <script src="js/audio.js"></script>
    <script src="js/debug.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/event.js"></script>
    <script src="js/text_engine.js"></script>
    <script src="js/heroines_data.js"></script>

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-S3QX32FZWM"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      // あなたの測定ID
      gtag('config', 'G-S3QX32FZWM');
    </script>
    <script src="js/analytics.js"></script>

    <script src="js/main.js"></script>
</head>
<body>
    <svg style="position:fixed; top:-100%; left:-100%; width:0; height:0;">
        <filter id="water-filter">
            <feTurbulence type="fractalNoise" baseFrequency="0.015 0.015" numOctaves="3" seed="1" result="noise">
                <animate attributeName="baseFrequency" dur="15s" values="0.015 0.015;0.02 0.03;0.015 0.015" repeatCount="indefinite" />
            </feTurbulence>
            <feDisplacementMap in="SourceGraphic" in2="noise" scale="20" />
        </filter>
    </svg>

    <div id="fade-overlay"></div>

    <div id="loading-screen">
        <div style="font-size: 24px; letter-spacing: 5px;">LOADING ASSETS</div>
        <div id="load-bar-container"><div id="load-bar-fill"></div></div>
        <div id="load-status">Initializing...</div>
    </div>

    <div id="debug-toggle-btn" onclick="toggleDebugPanel()"><i class="fa-solid fa-gear"></i></div>
<div id="debug-panel" style="display:none;">
        <h3>SETTINGS</h3>
        <div style="margin-bottom: 15px; border-bottom: 1px solid #444; padding-bottom: 10px;">
            <div style="font-size:12px; margin-bottom:2px;">BGM VOLUME</div>
            <input type="range" id="bgm-slider" min="0" max="1" step="0.05" style="width:100%" 
                   oninput="setBgmVolume(this.value)">
            
            <div style="font-size:12px; margin-bottom:2px; margin-top:8px;">SE VOLUME</div>
            <input type="range" id="se-slider" min="0" max="1" step="0.05" style="width:100%" 
                   oninput="setSeVolume(this.value)">
        </div>

        <h4>Debug Menu</h4>

        <div style="margin-bottom:5px; font-size:12px; color:#aaa;">DATA CONTROL</div>
        <button onclick="debugResetAllData()" class="debug-always" style="background:#cc3333; color:white; width:100%; margin-bottom:5px;">
            <i class="fa-solid fa-trash"></i> Reset All Data
        </button>
        
        <div style="display:flex; gap:5px; margin-bottom:15px;">
            <button onclick="debugToggleBoosts()" class="debug-always"style="flex:1; background:#111; border: 1px solid #76ff03; color: #76ff03; font-weight:bold;">
                <i class="fa-solid fa-unlock"></i> Unlock Boosts
            </button>
            <button onclick="debugMaxStats()" style="flex:1; background:#111; border: 1px solid #00e5ff; color: #00e5ff; font-weight:bold;">
                <i class="fa-solid fa-bolt"></i> Status MAX
            </button>
        </div>
        
        <div style="margin-bottom:5px; font-size:12px; color:#aaa;">TURN CONTROL</div>
        <div style="display:flex; gap:5px; margin-bottom:15px;">
            <button onclick="debugModTurn(-5)" style="flex:1;">-5</button>
            <button onclick="debugModTurn(-1)" style="flex:1;">-1</button>
            <button onclick="debugModTurn(1)" style="flex:1;">+1</button>
            <button onclick="debugModTurn(5)" style="flex:1;">+5</button>
        </div>

        <div style="margin-bottom:5px; font-size:12px; color:#aaa;">EVENT TESTER</div>
        <select id="debug-map-select" onchange="updateDebugEventList()" style="width:100%; margin-bottom:5px;"></select>
        <select id="debug-event-select" style="width:100%; margin-bottom:5px;"></select>
        <button onclick="launchDebugTestEvent()" style="width:100%; margin-bottom:15px;">
            <i class="fa-solid fa-play"></i> Launch Test
        </button>

        <div style="margin-bottom:5px; font-size:12px; color:#aaa;">HEROINE PROGRESS</div>
        <div id="debug-heroine-sliders" style="margin-bottom:15px;"></div>
        
        <div style="margin-bottom:5px; font-size:12px; color:#aaa;">GAMEPLAY</div>
        <button onclick="debugFinishGame()" style="width:100%; margin-bottom:5px;">
            <i class="fa-solid fa-flag-checkered"></i> Finish
        </button>
        <button id="force-heroine-btn" onclick="toggleForceHeroine()" style="width:100%;">
            <i class="fa-solid fa-heart"></i> Force: OFF
        </button>
    </div>

    <div id="game-container">
        <div id="background-layer"></div>
        
        <div id="monologue-container"><div class="monologue-text"></div></div>

        <div id="map-spots-container"></div>
        <div id="event-still-layer"></div>
        <div id="character-layer"></div>
        
        <div id="top-ui-container">
            <div id="turn-display"><span style="margin-right:15px; font-weight:bold;"><i class="fa-solid fa-hourglass-start"></i> TURN</span><span id="turn-count">1</span>/20</div>
            <button id="status-toggle-btn" class="ui-btn" onclick="toggleStats()">STATUS</button>
            <button id="log-btn" class="ui-btn" onclick="toggleLog()">LOG</button>
            <button id="fullscreen-btn" class="fullscreen-btn" onclick="toggleFullScreen()"><i class="fa-solid fa-expand"></i></button>
        </div>

        <div id="stats-panel"><div id="stat-list"></div></div>
        <div id="log-overlay"><div id="log-window"><div id="log-content"></div></div><button class="ui-btn" onclick="toggleLog()">CLOSE</button></div>
        
        <div id="click-overlay" onclick="proceedText()"></div>
        <div id="message-window" onclick="proceedText()">
            <div id="location-badge">
                <span id="loc-icon"></span><span id="loc-name"></span>
                <span id="loc-stats"></span>
            </div>
            <div id="char-name-badge"></div>
            <div id="message-text"></div>
            <div id="result-display"></div>
            <div id="page-cursor"><i class="fa-solid fa-caret-down"></i></div>
        </div>
        
        <div id="title-screen" class="overlay-screen">
            <div id="title-img-bg" style="background-image: url('images/title.webp');"></div>
            <button id="title-fullscreen-btn" class="fullscreen-btn" onclick="toggleFullScreen()"><i class="fa-solid fa-expand"></i></button>
            
            <div class="title-logo-wrapper">
                <div class="title-logo-container">
                    <h1 class="size-days">DAYS</h1><h1 class="size-in">IN</h1><h1 class="size-magh">MAGHRIBAL</h1>
                </div>
                <div class="title-underline"></div>
                <h2 class="jp-title">- マグリバルにて -</h2>
            </div>

            <div class="title-btn-container">
                <button id="start-btn" onclick="startOP()">GAME START</button>
                <button id="continue-btn" onclick="continueGame()">CONTINUE</button>
            </div>

            <div id="boost-container"></div>
            <div id="past-records-container">
                <div class="record-title"><i class="fa-solid fa-clock-rotate-left"></i> PAST RECORDS</div>
                <div id="past-records-list"></div>
            </div>
        </div>

        <div id="op-screen" class="overlay-screen hidden-screen" onclick="nextOP()">
            <div id="op-text"></div><div style="position:absolute; bottom:30px;"><i class="fa-solid fa-caret-down" style="font-size:24px; color:#b08d55; animation:cursorBlink 1s infinite alternate;"></i></div>
        </div>

        <div id="ed-screen" class="overlay-screen hidden-screen">
            <div id="ed-rank"></div>
            <div id="ed-heroine" style="color:#ffcc00; font-weight:bold; margin-bottom:20px; display: flex; justify-content: center; align-items: center; gap: 4px;"></div>
            <div id="ed-msg"></div>
            <div id="ed-stats"></div>
            <div style="display:flex; gap:20px; align-items:center;">
                <button id="ed-log-btn" onclick="toggleLog()">REVIEW LOG</button>
                <button id="retry-btn" onclick="retryGame()">RETRY</button>
            </div>
        </div>
    </div>
</body>
</html>